apiVersion: database.oci.upbound.io/v1alpha1
kind: DbSystem
metadata:
  annotations:
    meta.upbound.io/example-id: database/v1alpha1/dbsystem
  labels:
    testing.upbound.io/example-name: test_db_system
  name: test-db-system
spec:
  forProvider:
    availabilityDomain: ${data.oci_identity_availability_domains.test_availability_domain.availability_domains.0.name}
    compartmentIdSelector:
      matchLabels:
        testing.upbound.io/example-name: example
    cpuCoreCount: ${var.cpu_core_count}
    dataStorageSizeInGb: "256"
    databaseEdition: ENTERPRISE_EDITION
    dbHome:
    - database:
      - adminPasswordSecretRef:
          key: example-key
          name: example-secret
          namespace: upbound-system
        characterSet: AL32UTF8
        dbName: tfDB
        dbWorkload: OLTP
        definedTags: ${tomap({"example-tag-namespace-all.example-tag" = "originalValue"})}
        freeformTags:
          Department: Finance
        ncharacterSet: AL16UTF16
        pdbName: tfPDB
      dbVersion: 23.4.1.24.06
      displayName: tfDBHome
    dbSystemOptions:
    - storageManagement: LVM
    definedTags: ${tomap({"example-tag-namespace-all.example-tag" = "originalValue"})}
    diskRedundancy: NORMAL
    displayName: tfDBSystem-PDB
    domain: ${oci_core_subnet.test_subnet.dns_label}.${oci_core_virtual_network.test_vcn.dns_label}.oraclevcn.com
    faultDomains:
    - FAULT-DOMAIN-1
    freeformTags:
      Department: Finance
    hostname: OracleDB
    licenseModel: LICENSE_INCLUDED
    nodeCount: "1"
    shape: VM.Standard2.1
    sshPublicKeys:
    - ssh-rsa KKKLK3NzaC1yc2EAAAADAQABAAABAQC+UC9MFNA55NIVtKPIBCNw7++ACXhD0hx+Zyj25JfHykjz/QU3Q5FAU3DxDbVXyubgXfb/GJnrKRY8O4QDdvnZZRvQFFEOaApThAmCAM5MuFUIHdFvlqP+0W+ZQnmtDhwVe2NCfcmOrMuaPEgOKO3DOW6I/qOOdO691Xe2S9NgT9HhN0ZfFtEODVgvYulgXuCCXsJs+NUqcHAOxxFUmwkbPvYi0P0e2DT8JKeiOOC8VKUEgvVx+GKmqasm+Y6zHFW7vv3g2GstE1aRs3mttHRoC/JPM86PRyIxeWXEMzyG5wHqUu4XZpDbnWNxi6ugxnAGiL3CrIFdCgRNgHz5qS1l
      MustWin
    subnetIdSelector:
      matchLabels:
        testing.upbound.io/example-name: test_subnet
    timeouts:
    - create: 60m
      delete: 2h

---

apiVersion: networking.oci.upbound.io/v1alpha1
kind: InternetGateway
metadata:
  annotations:
    meta.upbound.io/example-id: database/v1alpha1/dbsystem
  labels:
    testing.upbound.io/example-name: test_internet_gateway
  name: test-internet-gateway
spec:
  forProvider:
    compartmentIdSelector:
      matchLabels:
        testing.upbound.io/example-name: example
    displayName: tfInternetGateway
    vcnIdSelector:
      matchLabels:
        testing.upbound.io/example-name: test_vcn

---

apiVersion: networking.oci.upbound.io/v1alpha1
kind: RouteTable
metadata:
  annotations:
    meta.upbound.io/example-id: database/v1alpha1/dbsystem
  labels:
    testing.upbound.io/example-name: test_route_table
  name: test-route-table
spec:
  forProvider:
    compartmentIdSelector:
      matchLabels:
        testing.upbound.io/example-name: example
    routeRules:
    - destination: 0.0.0.0/0
      destinationType: CIDR_BLOCK
      networkEntityIdSelector:
        matchLabels:
          testing.upbound.io/example-name: test_internet_gateway
    vcnIdSelector:
      matchLabels:
        testing.upbound.io/example-name: test_vcn

---

apiVersion: networking.oci.upbound.io/v1alpha1
kind: Subnet
metadata:
  annotations:
    meta.upbound.io/example-id: database/v1alpha1/dbsystem
  labels:
    testing.upbound.io/example-name: test_subnet
  name: test-subnet
spec:
  forProvider:
    availabilityDomain: ${data.oci_identity_availability_domains.test_availability_domain.availability_domains.0.name}
    cidrBlock: 10.1.20.0/24
    compartmentIdSelector:
      matchLabels:
        testing.upbound.io/example-name: example
    dhcpOptionsIdSelector:
      matchLabels:
        testing.upbound.io/example-name: test_vcn
    displayName: tfSubnet
    dnsLabel: tfsubnet
    routeTableIdSelector:
      matchLabels:
        testing.upbound.io/example-name: test_route_table
    securityListIdRefs:
    - name: test_vcn
    vcnIdSelector:
      matchLabels:
        testing.upbound.io/example-name: test_vcn

---

apiVersion: core.oci.upbound.io/v1alpha1
kind: VirtualNetwork
metadata:
  annotations:
    meta.upbound.io/example-id: database/v1alpha1/dbsystem
  labels:
    testing.upbound.io/example-name: test_vcn
  name: test-vcn
spec:
  forProvider:
    cidrBlock: 10.1.0.0/16
    compartmentIdSelector:
      matchLabels:
        testing.upbound.io/example-name: example
    displayName: tfVCN
    dnsLabel: tfvcn
