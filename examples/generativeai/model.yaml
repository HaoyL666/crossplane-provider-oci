apiVersion: generativeai.oci.upbound.io/v1alpha1
kind: Model
metadata:
  annotations:
    meta.upbound.io/example-id: generativeai/v1alpha1/model
  labels:
    testing.upbound.io/example-name: llama3_test_model
  name: llama3-test-model
spec:
  forProvider:
    baseModelId: ${local.llama_base_model_id}
    compartmentIdSelector:
      matchLabels:
        testing.upbound.io/example-name: example
    description: ${var.test_model_description}
    displayName: ${var.llama3_test_model_display_name}
    fineTuneDetails:
    - dedicatedAiClusterId: ${data.oci_generative_ai_dedicated_ai_cluster.test_dedicated_ai_cluster_large_generic.id}
      trainingConfig:
      - earlyStoppingPatience: "15"
        earlyStoppingThreshold: "0.0001"
        learningRate: "0.0002"
        logModelMetricsIntervalInSteps: "10"
        loraAlpha: "8"
        loraDropout: "0.1"
        loraR: "8"
        totalTrainingEpochs: "3"
        trainingBatchSize: "8"
        trainingConfigType: LORA_TRAINING_CONFIG
      trainingDataset:
      - bucketSelector:
          matchLabels:
            testing.upbound.io/example-name: fine_tune_bucket
        datasetType: OBJECT_STORAGE
        namespace: ${data.oci_objectstorage_namespace.ns.namespace}
        objectSelector:
          matchLabels:
            testing.upbound.io/example-name: fine_tune_object
    freeformTags: ${var.test_freeform_tags}
    vendor: ${var.test_model_vendor}
    version: ${var.test_model_version}

---

apiVersion: objectstorage.oci.upbound.io/v1alpha1
kind: Bucket
metadata:
  annotations:
    meta.upbound.io/example-id: generativeai/v1alpha1/model
  labels:
    testing.upbound.io/example-name: fine_tune_bucket
  name: fine-tune-bucket
spec:
  forProvider:
    compartmentIdSelector:
      matchLabels:
        testing.upbound.io/example-name: example
    name: fineTuneData
    namespace: ${data.oci_objectstorage_namespace.ns.namespace}

---

apiVersion: objectstorage.oci.upbound.io/v1alpha1
kind: Object
metadata:
  annotations:
    meta.upbound.io/example-id: generativeai/v1alpha1/model
  labels:
    testing.upbound.io/example-name: fine_tune_object
  name: fine-tune-object
spec:
  forProvider:
    bucketSelector:
      matchLabels:
        testing.upbound.io/example-name: example
    content: |
      {"prompt": "1", "completion": "one"}
      {"prompt": "2", "completion": "two"}
      {"prompt": "3", "completion": "three"}
      {"prompt": "4", "completion": "four"}
      {"prompt": "5", "completion": "five"}
      {"prompt": "6", "completion": "six"}
      {"prompt": "7", "completion": "seven"}
      {"prompt": "8", "completion": "eight"}
      {"prompt": "9", "completion": "nine"}
      {"prompt": "10", "completion": "ten"}
      {"prompt": "11", "completion": "eleven"}
      {"prompt": "12", "completion": "twelve"}
      {"prompt": "13", "completion": "thirteen"}
      {"prompt": "14", "completion": "fourteen"}
      {"prompt": "15", "completion": "fifteen"}
      {"prompt": "16", "completion": "sixteen"}
      {"prompt": "17", "completion": "seventeen"}
      {"prompt": "18", "completion": "eighteen"}
      {"prompt": "19", "completion": "nineteen"}
      {"prompt": "20", "completion": "twenty"}
      {"prompt": "21", "completion": "twenty-one"}
      {"prompt": "22", "completion": "twenty-two"}
      {"prompt": "23", "completion": "twenty-three"}
      {"prompt": "24", "completion": "twenty-four"}
      {"prompt": "25", "completion": "twenty-five"}
      {"prompt": "26", "completion": "twenty-six"}
      {"prompt": "27", "completion": "twenty-seven"}
      {"prompt": "28", "completion": "twenty-eight"}
      {"prompt": "29", "completion": "twenty-nine"}
      {"prompt": "30", "completion": "thirty"}
      {"prompt": "31", "completion": "thirty-one"}
      {"prompt": "32", "completion": "thirty-two"}
    namespace: ${data.oci_objectstorage_namespace.ns.namespace}
    object: uhc_data.jsonl
