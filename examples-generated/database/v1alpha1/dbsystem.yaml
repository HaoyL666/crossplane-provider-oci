apiVersion: database.oci.upbound.io/v1alpha1
kind: DbSystem
metadata:
  annotations:
    meta.upbound.io/example-id: database/v1alpha1/dbsystem
  labels:
    testing.upbound.io/example-name: test_db_system
  name: test-db-system
spec:
  forProvider:
    availabilityDomain: ${var.db_system_availability_domain}
    backupNetworkNsgIds: ${var.db_system_backup_network_nsg_ids}
    backupSubnetIdSelector:
      matchLabels:
        testing.upbound.io/example-name: test_subnet
    clusterName: ${var.db_system_cluster_name}
    compartmentIdSelector:
      matchLabels:
        testing.upbound.io/example-name: example
    computeCount: ${var.db_system_compute_count}
    computeModel: ${var.db_system_compute_model}
    cpuCoreCount: ${var.db_system_cpu_core_count}
    dataCollectionOptions:
    - isDiagnosticsEventsEnabled: ${var.db_system_data_collection_options_is_diagnostics_events_enabled}
      isHealthMonitoringEnabled: ${var.db_system_data_collection_options_is_health_monitoring_enabled}
      isIncidentLogsEnabled: ${var.db_system_data_collection_options_is_incident_logs_enabled}
    dataStoragePercentage: ${var.db_system_data_storage_percentage}
    dataStorageSizeInGb: ${var.db_system_data_storage_size_in_gb}
    databaseEdition: ${var.db_system_database_edition}
    dbHome:
    - database:
      - adminPasswordSecretRef:
          key: example-key
          name: example-secret
          namespace: upbound-system
        backupIdSelector:
          matchLabels:
            testing.upbound.io/example-name: test_backup
        backupTdePasswordSecretRef:
          key: example-key
          name: example-secret
          namespace: upbound-system
        characterSet: ${var.db_system_db_home_database_character_set}
        databaseIdSelector:
          matchLabels:
            testing.upbound.io/example-name: test_database
        databaseSoftwareImageIdSelector:
          matchLabels:
            testing.upbound.io/example-name: test_database_software_image
        dbBackupConfig:
        - autoBackupEnabled: ${var.db_system_db_home_database_db_backup_config_auto_backup_enabled}
          autoBackupWindow: ${var.db_system_db_home_database_db_backup_config_auto_backup_window}
          autoFullBackupDay: ${var.db_system_db_home_database_db_backup_config_auto_full_backup_day}
          autoFullBackupWindow: ${var.db_system_db_home_database_db_backup_config_auto_full_backup_window}
          backupDeletionPolicy: ${var.db_system_db_home_database_db_backup_config_backup_deletion_policy}
          backupDestinationDetails:
          - backupRetentionPolicyOnTerminate: ${var.db_system_db_home_database_db_backup_config_backup_destination_details_backup_retention_policy_on_terminate}
            dbrsPolicyIdSelector:
              matchLabels:
                testing.upbound.io/example-name: test_policy
            id: ${var.db_system_db_home_database_db_backup_config_backup_destination_details_id}
            isRemote: ${var.db_system_db_home_database_db_backup_config_backup_destination_details_is_remote}
            isRetentionLockEnabled: ${var.db_system_db_home_database_db_backup_config_backup_destination_details_is_retention_lock_enabled}
            remoteRegion: ${var.db_system_db_home_database_db_backup_config_backup_destination_details_remote_region}
            type: ${var.db_system_db_home_database_db_backup_config_backup_destination_details_type}
          recoveryWindowInDays: ${var.db_system_db_home_database_db_backup_config_recovery_window_in_days}
          runImmediateFullBackup: ${var.db_system_db_home_database_db_backup_config_run_immediate_full_backup}
        dbDomain: ${var.db_system_db_home_database_db_domain}
        dbName: ${var.db_system_db_home_database_db_name}
        dbWorkload: ${var.db_system_db_home_database_db_workload}
        definedTags: ${var.db_system_db_home_database_defined_tags}
        encryption_key_location_details:
        - azure_encryption_key_id: ${oci_kms_key.test_key.id}
          hsm_password: ${var.db_system_db_home_database_encryption_key_location_details_hsm_password}
          provider_type: ${var.db_system_db_home_database_encryption_key_location_details_provider_type}
        freeformTags: ${var.db_system_db_home_database_freeform_tags}
        key_store_id: ${oci_database_key_store.test_key_store.id}
        kmsKeyIdSelector:
          matchLabels:
            testing.upbound.io/example-name: test_key
        kmsKeyVersionIdSelector:
          matchLabels:
            testing.upbound.io/example-name: test_key_version
        ncharacterSet: ${var.db_system_db_home_database_ncharacter_set}
        pdbName: ${var.db_system_db_home_database_pdb_name}
        pluggableDatabases: ${var.db_system_db_home_database_pluggable_databases}
        sid_prefix: ${var.db_system_db_home_database_sid_prefix}
        source_encryption_key_location_details:
        - azure_encryption_key_id: ${oci_kms_key.test_key.id}
          hsm_password: ${var.db_system_db_home_database_source_encryption_key_location_details_hsm_password}
          provider_type: ${var.db_system_db_home_database_source_encryption_key_location_details_provider_type}
        tdeWalletPasswordSecretRef:
          key: example-key
          name: example-secret
          namespace: upbound-system
        timeStampForPointInTimeRecovery: ${var.db_system_db_home_database_time_stamp_for_point_in_time_recovery}
        vaultIdSelector:
          matchLabels:
            testing.upbound.io/example-name: test_vault
      databaseSoftwareImageIdSelector:
        matchLabels:
          testing.upbound.io/example-name: test_database_software_image
      dbVersion: ${var.db_system_db_home_db_version}
      definedTags: ${var.db_system_db_home_defined_tags}
      displayName: ${var.db_system_db_home_display_name}
      freeformTags: ${var.db_system_db_home_freeform_tags}
      isUnifiedAuditingEnabled: ${var.db_system_db_home_is_unified_auditing_enabled}
    dbSystemOptions:
    - storageManagement: ${var.db_system_db_system_options_storage_management}
    definedTags: ${var.db_system_defined_tags}
    diskRedundancy: ${var.db_system_disk_redundancy}
    displayName: ${var.db_system_display_name}
    domain: ${var.db_system_domain}
    faultDomains: ${var.db_system_fault_domains}
    freeformTags:
      Department: Finance
    hostname: ${var.db_system_hostname}
    kmsKeyIdSelector:
      matchLabels:
        testing.upbound.io/example-name: test_key
    kmsKeyVersionIdSelector:
      matchLabels:
        testing.upbound.io/example-name: test_key_version
    licenseModel: ${var.db_system_license_model}
    maintenanceWindowDetails:
    - customActionTimeoutInMins: ${var.db_system_maintenance_window_details_custom_action_timeout_in_mins}
      daysOfWeek:
      - name: ${var.db_system_maintenance_window_details_days_of_week_name}
      hoursOfDay: ${var.db_system_maintenance_window_details_hours_of_day}
      isCustomActionTimeoutEnabled: ${var.db_system_maintenance_window_details_is_custom_action_timeout_enabled}
      isMonthlyPatchingEnabled: ${var.db_system_maintenance_window_details_is_monthly_patching_enabled}
      leadTimeInWeeks: ${var.db_system_maintenance_window_details_lead_time_in_weeks}
      months:
      - name: ${var.db_system_maintenance_window_details_months_name}
      patchingMode: ${var.db_system_maintenance_window_details_patching_mode}
      preference: ${var.db_system_maintenance_window_details_preference}
      skipRu: ${var.db_system_maintenance_window_details_skip_ru}
      weeksOfMonth: ${var.db_system_maintenance_window_details_weeks_of_month}
    nodeCount: ${var.db_system_node_count}
    nsgIds: ${var.db_system_nsg_ids}
    privateIp: ${var.db_system_private_ip}
    privateIpV6: ${var.db_system_private_ip_v6}
    securityAttributes: ${var.db_system_security_attributes}
    shape: ${var.db_system_shape}
    source: ${var.db_system_source}
    sourceDbSystemIdSelector:
      matchLabels:
        testing.upbound.io/example-name: test_db_system
    sparseDiskgroup: ${var.db_system_sparse_diskgroup}
    sshPublicKeys: ${var.db_system_ssh_public_keys}
    storageVolumePerformanceMode: ${var.db_system_storage_volume_performance_mode}
    subnetIdSelector:
      matchLabels:
        testing.upbound.io/example-name: test_subnet
    timeZone: ${var.db_system_time_zone}
